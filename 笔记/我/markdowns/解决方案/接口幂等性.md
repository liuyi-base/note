# 1、幂等性

## 1.1、幂等性定义

接口幂等性就是用户对于同一操作发起的一次请求或者多次请求的结果是一致的

## 1.2、适用场景

1. 用户多次点击按钮 
2. 用户页面回退再次提交 
3. 微服务互相调用，由于网络问题，导致请求失败。feign 触发重试机制 
4. 其他业务情况 

## 1.3、解决方案

### 1.3.1、token

1. 把token保存在redis中，请求时先查询Redis，如果有token则执行，执行完后删除
2. 一定要先删除，在执行，并且执行失败后重新获取token，再次执行
3. 获取、比较、删除必须是原子性，可以用脚本代替

```
if redis.call('get', KEYS[1]) == ARGV[1] then return redis.call('del', KEYS[1]) else return 0 end
```

### 1.3.2、各种锁机制

1. 乐观锁
2. 悲观锁

### 1.3.2、各种唯一性约束

1. 数据库主键
2. redis：将数据用md5存储在redis中

### 1.3.3、防重表

### 1.3.4、全局唯一id